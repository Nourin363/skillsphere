{% extends 'base.html' %}
{% block content %}

<section class="max-w-7xl mx-auto px-6 py-10 transition-colors duration-300" x-data="{ openModal: false, selected: null }">
  <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-6">Available Micro-Internships</h1>

  {% if internships %}
  <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
    {% for internship in internships %}
    <div 
      class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md border border-gray-200 dark:border-gray-700 hover:shadow-lg hover:-translate-y-1 transform transition duration-200 flex flex-col justify-between"
      @click="selected = {{ internship.id }}; openModal = true">
      <div>
        <h3 class="font-semibold text-gray-900 dark:text-gray-100 text-lg mb-2">{{ internship.title }}</h3>
        <p class="text-sm text-gray-600 dark:text-gray-400 mb-3">{{ internship.description|truncatewords:20 }}</p>
        <div class="text-sm text-gray-700 dark:text-gray-300 space-y-1">
          <p><strong>Duration:</strong> {{ internship.duration }}</p>
          <p><strong>Points:</strong> {{ internship.reward_points }}</p>
          <p><strong>Mentor:</strong> {{ internship.mentor|default:"AI Assistant" }}</p>
        </div>
      </div>

      <div class="mt-5">
        <button 
          class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-2 rounded-lg font-medium hover:from-purple-600 hover:to-blue-600 transition transform hover:scale-[1.02]">
          Apply Now
        </button>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <div class="text-center py-16">
    <p class="text-gray-500 dark:text-gray-400 text-lg">No internships available right now. Check back later!</p>
  </div>
  {% endif %}

  <!-- ðŸªŸ Apply Modal -->
  <div 
    x-show="openModal" 
    x-transition.opacity 
    class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
  >
    <div 
      @click.away="openModal = false" 
      class="bg-white dark:bg-gray-800 rounded-xl shadow-lg w-full max-w-md p-6 transform transition relative"
    >
      <button 
        @click="openModal = false" 
        class="absolute top-3 right-4 text-gray-500 dark:text-gray-300 hover:text-gray-700 dark:hover:text-white text-xl font-bold">
        Ã—
      </button>

      <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-4">Apply for Internship</h2>
      <p class="text-gray-600 dark:text-gray-400 mb-4">Confirm your interest below. Once submitted, your mentor will review your application.</p>

      <form method="POST" action="{% url 'apply_internship' %}" class="space-y-4">
        {% csrf_token %}
        <input type="hidden" name="internship_id" :value="selected">
        
        <div>
          <label for="motivation" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Why are you interested?</label>
          <textarea 
            id="motivation" 
            name="motivation" 
            rows="3" 
            class="w-full px-4 py-2 rounded-md border border-gray-300 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-200 focus:ring-2 focus:ring-blue-500 outline-none transition"
            placeholder="Write a short motivation..."
            required></textarea>
        </div>

        <button 
          type="submit" 
          class="w-full py-2.5 bg-gradient-to-r from-blue-600 to-purple-600 text-white font-semibold rounded-lg hover:from-purple-600 hover:to-blue-600 transition transform hover:scale-[1.02]">
          Submit Application
        </button>
      </form>
    </div>
  </div>
</section>

{% endblock %}
