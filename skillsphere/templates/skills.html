{% extends 'base.html' %}
{% block content %}

<section class="min-h-screen bg-gradient-to-b from-blue-50 via-purple-50 to-white dark:from-gray-900 dark:via-gray-950 dark:to-gray-900 transition-colors duration-500 px-6 py-16" x-data="{ openAdd: false, openEdit: false, openDelete: false, selectedSkillId: null }">

  <!-- üåü Header -->
  <div class="max-w-6xl mx-auto text-center mb-10">
    <h1 class="text-4xl font-bold text-gray-900 dark:text-white fade-up">My Skills</h1>
    <p class="text-gray-600 dark:text-gray-400 mt-2 fade-up delay-1">Track your skills, edit progress, or remove old ones üöÄ</p>
  </div>

  <!-- ü™Ñ Add Skill Button -->
  <div class="flex justify-center mb-8 fade-up delay-2">
    <button 
      @click="openAdd = true" 
      class="px-6 py-3 rounded-xl text-white font-medium bg-gradient-to-r from-purple-600 to-blue-600 shadow-md hover:shadow-lg hover:scale-[1.05] transition">
      + Add New Skill
    </button>
  </div>

  <!-- üß† Skills List -->
  <div class="max-w-6xl mx-auto">
    {% if user_skills %}
      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
        {% for skill in user_skills %}
        <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-md hover:shadow-2xl transform hover:scale-[1.02] transition-all duration-300 border border-gray-200 dark:border-gray-700 relative">

          <!-- Skill Header -->
          <div class="flex justify-between items-start mb-3">
            <div>
              <h3 class="font-semibold text-lg text-gray-900 dark:text-white">{{ skill.skill.name }}</h3>
              <span class="text-sm text-gray-500 dark:text-gray-400">{{ skill.skill.category }}</span>
            </div>

            <!-- Action Buttons -->
            <div class="flex gap-2">
              <button 
                @click="openEdit = true; selectedSkillId = {{ skill.id }}"
                class="text-blue-500 hover:text-blue-700 transition">
                ‚úèÔ∏è
              </button>
              <button 
                @click="openDelete = true; selectedSkillId = {{ skill.id }}"
                class="text-red-500 hover:text-red-700 transition">
                üóëÔ∏è
              </button>
            </div>
          </div>

          <!-- Progress Bar -->
          <div class="relative w-full h-3 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden mt-3">
            <div class="absolute top-0 left-0 h-3 bg-gradient-to-r from-purple-500 to-blue-500 rounded-full transition-all duration-700" style="width: {{ skill.progress }}%"></div>
          </div>
          <div class="mt-3 text-right text-sm text-gray-500 dark:text-gray-400">{{ skill.progress }}% Complete</div>
        </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="text-center py-24 fade-up delay-3">
        <img src="https://cdn-icons-png.flaticon.com/512/906/906324.png" alt="Add new skill" class="mx-auto mb-6 w-24 opacity-80">
        <p class="text-lg text-gray-600 dark:text-gray-400 mb-6">No skills added yet. Start your learning journey now!</p>
        <button 
          @click="openAdd = true"
          class="px-6 py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white font-medium rounded-xl shadow-md hover:scale-[1.05] hover:shadow-lg transition">
          Add Your First Skill ‚ú®
        </button>
      </div>
    {% endif %}
  </div>

  <!-- ‚ûï Add Skill Modal -->
  <div x-show="openAdd" x-transition.opacity class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div @click.away="openAdd = false" class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl w-full max-w-md p-8 animate-fade-in">
      <h2 class="text-xl font-semibold mb-4 text-gray-900 dark:text-white">Add New Skill</h2>
      <form method="POST" action="{% url 'add_skill' %}" class="space-y-5">
        {% csrf_token %}
        <input type="text" name="skill_name" placeholder="Skill name" class="input-field" required>
        <input type="text" name="category" placeholder="Category (optional)" class="input-field">
        <input type="number" name="progress" placeholder="Progress (0‚Äì100)" class="input-field" min="0" max="100" required>
        <button type="submit" class="btn-primary w-full">Save Skill</button>
      </form>
    </div>
  </div>

  <!-- ‚úèÔ∏è Edit Skill Modal -->
  <template x-if="selectedSkillId">
    <div x-show="openEdit" x-transition.opacity class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
      <div @click.away="openEdit = false" class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl w-full max-w-md p-8 animate-fade-in">
        <h2 class="text-xl font-semibold mb-4 text-gray-900 dark:text-white">Edit Skill</h2>
        <form method="POST" :action="`/skills/${selectedSkillId}/edit/`" class="space-y-5">
          {% csrf_token %}
          <input type="text" name="skill_name" placeholder="New skill name" class="input-field" required>
          <input type="text" name="category" placeholder="New category" class="input-field">
          <input type="number" name="progress" placeholder="Progress (0‚Äì100)" class="input-field" min="0" max="100" required>
          <button type="submit" class="btn-primary w-full">Update Skill</button>
        </form>
      </div>
    </div>
  </template>

  <!-- üóëÔ∏è Delete Confirmation Modal -->
  <template x-if="selectedSkillId">
    <div x-show="openDelete" x-transition.opacity class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50">
      <div @click.away="openDelete = false" class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl w-full max-w-md p-8 animate-fade-in text-center">
        <h2 class="text-xl font-semibold mb-4 text-gray-900 dark:text-white">Delete Skill</h2>
        <p class="text-gray-600 dark:text-gray-400 mb-6">Are you sure you want to delete this skill? This action cannot be undone.</p>
        <form method="POST" :action="`/skills/${selectedSkillId}/delete/`">
          {% csrf_token %}
          <div class="flex justify-center gap-4">
            <button type="submit" class="bg-red-600 text-white px-5 py-2 rounded-lg hover:bg-red-700 transition">Delete</button>
            <button type="button" @click="openDelete = false" class="bg-gray-300 dark:bg-gray-700 text-gray-900 dark:text-gray-200 px-5 py-2 rounded-lg">Cancel</button>
          </div>
        </form>
      </div>
    </div>
  </template>

</section>

<!-- üåà Toast Notifications -->
{% if messages %}
<div x-data="{ show: true }" x-show="show" x-init="setTimeout(() => show = false, 3000)" class="fixed top-6 right-6 space-y-2 z-50">
  {% for message in messages %}
  <div class="px-5 py-3 rounded-xl text-white font-medium shadow-lg animate-toast-in
              {% if message.tags == 'error' %} bg-red-500 {% elif message.tags == 'success' %} bg-green-600 {% else %} bg-blue-600 {% endif %}">
    {{ message }}
  </div>
  {% endfor %}
</div>
{% endif %}

<!-- üîÆ Styles -->
<style>
  [x-cloak] { display: none !important; }
  .input-field {
    width: 100%;
    padding: 10px 14px;
    border-radius: 8px;
    border: 1px solid #d1d5db;
    background-color: white;
    color: #111827;
    outline: none;
    transition: all 0.2s ease;
  }
  .dark .input-field {
    background-color: #111827;
    color: #f9fafb;
    border-color: #374151;
  }
  .input-field:focus {
    border-color: #7c3aed;
    box-shadow: 0 0 0 2px rgba(124, 58, 237, 0.3);
  }
  .btn-primary {
    background: linear-gradient(to right, #7c3aed, #3b82f6);
    color: white;
    font-weight: 600;
    padding: 10px 0;
    border-radius: 8px;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }
  .btn-primary:hover {
    transform: scale(1.03);
    box-shadow: 0 4px 14px rgba(59, 130, 246, 0.3);
  }
  .animate-fade-in { animation: fadeIn 0.25s ease-out; }
  @keyframes fadeIn {
    from { opacity: 0; transform: scale(0.95); }
    to { opacity: 1; transform: scale(1); }
  }
  .animate-toast-in {
    animation: toastIn 0.3s ease-out forwards;
  }
  @keyframes toastIn {
    from { opacity: 0; transform: translateY(-15px) scale(0.95); }
    to { opacity: 1; transform: translateY(0) scale(1); }
  }
</style>

{% endblock %}
